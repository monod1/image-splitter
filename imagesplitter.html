import React, { useState, useRef } from "react";
import { Button } from "@/components/ui/button";
import { Slider } from "@/components/ui/slider";

export default function ImageSplitter() {
  const [image, setImage] = useState(null);
  const [scale, setScale] = useState(100);
  const canvasRef = useRef(null);

  const cols = 3;
  const rows = 3;

  const handleUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (ev) => setImage(ev.target.result);
      reader.readAsDataURL(file);
    }
  };

  const drawPreview = () => {
    if (!image) return;
    const canvas = canvasRef.current;
    const ctx = canvas.getContext("2d");
    const img = new Image();
    img.src = image;
    img.onload = () => {
      const scaledWidth = (img.width * scale) / 100;
      const scaledHeight = (img.height * scale) / 100;
      canvas.width = scaledWidth;
      canvas.height = scaledHeight;

      ctx.clearRect(0, 0, scaledWidth, scaledHeight);
      ctx.drawImage(img, 0, 0, scaledWidth, scaledHeight);

      // Draw grid
      const cellW = scaledWidth / cols;
      const cellH = scaledHeight / rows;
      ctx.strokeStyle = "red";
      for (let i = 1; i < cols; i++) {
        ctx.beginPath();
        ctx.moveTo(i * cellW, 0);
        ctx.lineTo(i * cellW, scaledHeight);
        ctx.stroke();
      }
      for (let j = 1; j < rows; j++) {
        ctx.beginPath();
        ctx.moveTo(0, j * cellH);
        ctx.lineTo(scaledWidth, j * cellH);
        ctx.stroke();
      }
    };
  };

  return (
    <div className="flex flex-col items-center p-4 gap-4">
      <h1 className="text-2xl font-bold">Image Splitter Preview</h1>
      <input type="file" accept="image/*" onChange={handleUpload} />

      {image && (
        <>
          <div className="w-full max-w-2xl">
            <Slider
              value={[scale]}
              min={10}
              max={200}
              step={1}
              onValueChange={(v) => setScale(v[0])}
            />
            <p className="text-center">Scale: {scale}%</p>
          </div>
          <canvas ref={canvasRef} className="border shadow-lg" />
          <Button onClick={drawPreview}>Update Preview</Button>
        </>
      )}
    </div>
  );
}

